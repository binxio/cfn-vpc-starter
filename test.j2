{%- set vpc_cidr_block = vpc_cidr_block|default('10.0.0.0/19') %}
{%- set layers = layers | default(['public', 'private', 'data']) %}
{%- set azs = azs | default(['a', 'b', 'c']) %}
{%- set max_subnet_netmask = max_subnet_netmask|default(24) %}
{%- set min_layers = min_layers|default(4) %}{# min available layers in vpc, max 16 #}
{%- set min_azs = min_azs|default(8) %}{# min available subnets in layer, max 16 #}
{#- Do not edit after this line -#}
{%- set c = [1,1,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4] %}
{%- set vpc_netmask = vpc_cidr_block.split('/')[1] | int %}
{%- set count_azs = azs|length %}
{%- set count_layers = layers|length %}
{%- set layer_netmask = vpc_netmask + c[min_layers] %}
{%- set layer_size_mask = 32-layer_netmask %}
{%- set subnet_netmask = layer_netmask + c[min_azs] %}
{%- set subnet_size_mask = 32-subnet_netmask %}
{%- set subnet_netmask = max_subnet_netmask if subnet_netmask < max_subnet_netmask else subnet_netmask %}
{%- set public = 'public' %}{# if layer = public, direct internet access #}
{%- set private = 'private' %}{# if layer = private, internet access using nat gw #}
{#- Do not edit before this line -#}
vpc_cidr_block: {{ vpc_cidr_block }}
layer_netmask: {{ layer_netmask }}
layer_size_mask: {{ layer_size_mask }}
layer_subnets in vpc: {{ min_layers }}
subnet_netmask: {{ subnet_netmask }}
subnet_size_mask: {{ subnet_size_mask }}
subnets in layer: {{ min_azs }}
